
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import StrOutputParser
from langchain_upstage import ChatUpstage
from tqdm import tqdm
from langchain_chroma import Chroma
import os
import warnings




import json

# load json
# /data/taeho/self-rag/email_data.json
with open("/data/taeho/self-rag/email_data.json") as f:
    data = json.load(f)

from openai import OpenAI
os.environ["OPENAI_API_KEY"]  = ""#API KEY
           
client = OpenAI(
  organization='',
)


# make result json
result = []

for i, d in tqdm(enumerate(data)):
    try:
        # question generation
        completion = client.chat.completions.create(
                        model="gpt-3.5-turbo",
                        messages=[
                            {"role": "system", "content": f"e-mail이 있을 때 이에 대한 질문을 한국어로 만들어주세요."},
                            {"role": "user", "content": """Email:
            {'subject': '[KAIST KPC4IR] 11월 정기세미나 안내: 디지털 시대의 심리평가와 디지털 치료', 'from': [['한국4차산업혁명정책센터', 'kpc4ir@kaist.ac.kr']], 'to': [['학생#전체 (내국인)', 'gr_stud.ko@kaist.ac.kr'], ['직원#전체 (내국인)', 'gr_staff.ko@kaist.ac.kr'], ['학생#전체 (외국인)', 'gr_stud.en@kaist.ac.kr'], ['교수#전체', 'gr_prof@kaist.ac.kr']], 'cc': [], 'date': '"2022-10-24T07:09:19"', 'text_body': ['한국4차산업혁명정책센터에서 11월 정기세미나 정보를 아래와 같이 안내드립니다.&nbsp;참석을 희망하는&nbsp;KAIST&nbsp;구성원의 많은 참여 바랍니다.\n\n1.&nbsp;일시&nbsp;: 2022년&nbsp;11월&nbsp;1일(월) 11시~12시\n2.&nbsp;제목 :&nbsp;디지털 시대의 심리평가와 디지털 치료\n3. 내용 :\n-&nbsp;심리 평가와 치료는 전통적으로 1:1 대면으로 이루어지는 매우 전문적인 활동이지만, 최근 AI 및 각종 디지털 기기의 눈부신 발전으로 &nbsp;심리 평가와 치료 영역에서도 적용가능성이 탐색되고 있다. 특히 COVID-19로 인해 비대면 심리치료 서비스가 활성화되었고, Post-COVID 시대, ‘언택트 시대’가 도래하여 심리평가 및 치료의 디지털화는 더욱 가속화되어 전통적인 심리평가 및 치료 방식에 대한 패러다임 변화가 요구되고 있다. 이에 디지털 기반 심리평가 및 디지털치료제의 개발 현황, 예상되는 이점과 문제점, 쟁점에 대해 생각해보고자 한다.&nbsp;\n4.&nbsp;연사 : 신민섭 교수\n- (현)&nbsp;서울대학교의과대학 정신과학교실/서울대학교병원 소아청소년정신과 교수\n- (현)&nbsp;한국디지털 심리학회 회장&nbsp;\n- (전)&nbsp;미국 하버드 의과대학 소아정신과 방문교수\n- (전) 네덜란드 암스테르담 프리헤대학 아동임상신경심리학과 방문교수&nbsp;\n5.&nbsp;장소:&nbsp;온라인(https://kaist.zoom.us/j/84008656163?pwd=U3lXdGFZVkVqSkx2SmovQU1TRmVVUT09 https://kaist.zoom.us/j/84008656163?pwd=U3lXdGFZVkVqSkx2SmovQU1TRmVVUT09)\n6.&nbsp;언어:&nbsp;한국어\n7.&nbsp;대상: KAIST&nbsp;구성원\n8.&nbsp;문의:&nbsp;한국4차산업혁명정책센터 백단비 연구원(bee1@kaist.ac.kr, 042-350-8672)\n&nbsp;\n\n\n\n\n\n\n\n']}
                            Question: """},
                            {"role": "assistant", "content": f"[KAIST KPC4IR] 11월 정기세미나의 부제는 무엇인가요?"},
                            {"role": "user", "content": """Email:
            {'subject': '2022 Nobel Prize 수상 업적 해설 강연 개최 안내(Lecture on the Winners of Nobel Prize 2022 College of Natural Sciences, KAIST)', 'from': [['이봉여', 'bylee@kaist.ac.kr']], 'to': [['교수#전체', 'gr_prof@kaist.ac.kr'], ['학생#전체', 'gr_stud@kaist.ac.kr'], ['직원#전체', 'gr_staff@kaist.ac.kr']], 'cc': [], 'date': '"2022-10-24T08:51:26"', 'text_body': ['2022년 물리,&nbsp;화학,&nbsp;생리의학 분야에서 노벨상을 수상한 수상자들의 연구업적에 대한 해설 강연을 개최하오니 관심있는 분들의 많은 참여 부탁드립니다.\n\nThe College of Natural Sciences (CNS) at the Korea Advanced Institute of Science and Technology (KAIST) is hosting an online lecture to introduce the achievements of 2022 Nobel Prize laureates in physics, chemistry, and physiology or medicine. This will be a great opportunity to learn about how the prize winners have built their extraordinary career as a scientist and what they have focused on in their research.\nThe lecture is open to everyone, so please come and join us for the event!\n\n○ 일시(Date): October 25(Tue.) 2022, 12:00~13:00\n&nbsp; &nbsp;• Physics: 12:00 ~ 12:20\n&nbsp; &nbsp; &nbsp; &nbsp;라영식 교수 (물리학과)\n&nbsp; &nbsp; &nbsp; &nbsp;Professor Young-Sik Ra (Department of Physics)\n&nbsp; &nbsp;• Chemistry: 12:20 ~ 12:40\n&nbsp; &nbsp; &nbsp; &nbsp; 박윤수 교수 (화학과)\n&nbsp; &nbsp; &nbsp; &nbsp; Professor Yoonsu Park (Department of Chemistry)&nbsp;\n&nbsp; &nbsp;• Physiology or Medicine: 12:40 ~ 13:00\n&nbsp; &nbsp; &nbsp; &nbsp;정인경 교수 (생명과학과)\n&nbsp; &nbsp; &nbsp; &nbsp;Professor Inkyung Jung (Department of Biological Sciences)\n&nbsp; &nbsp;• MC\n&nbsp; &nbsp; &nbsp; &nbsp;변혜령 교수 (화학과)\n&nbsp; &nbsp; &nbsp; &nbsp;Professor Hye Ryung Byon (Department of Chemistry)&nbsp;\n○&nbsp;장소(venue):&nbsp;학술문화관&nbsp;5층 정근모콘퍼런스홀&nbsp;(E9)\n&nbsp; &nbsp; &nbsp;Jeong Geun-mo Conference Hall (Academic Cultural Complex E9, 5F)\n○&nbsp;Zoom:&nbsp;https://kaist.zoom.us/j/88355623723 https://kaist.zoom.us/j/88355623723\n○ 문의(Inquiry): 자연과학대학 교학팀 T. 042-350-2472,&nbsp;bylee@kaist.ac.kr\n&nbsp; &nbsp; Please contact the Academic Affairs Team of CNS at 042-350-2472 or&nbsp;bylee@kaist.ac.kr&nbsp;for any inquires.&nbsp;\n○ 현장 방문 선착순 200명 샌드위치와 음료수 제공\n&nbsp; &nbsp; Sandwiches and soda for the first 200 people on-site\n※ Zoom에서 동신통역이 제공될 예정입니다.\n&nbsp; &nbsp; &nbsp;Korean Talk,&nbsp;Simultaneous Interpretation into English via Zoom\n\n\n\n\n']}
                            Question: """},
                            {"role": "assistant", "content": f"어디서 2022 Nobel Prize 수상 업적 해설 강연이 개최되나요?"},
                            {"role": "user", "content": """Email:
            {'subject': '[바이오혁신경영전문대학원] 2024학년도 봄학기 Bio Innovation Forum 안내(6/13(목))', 'from': [['바이오혁신경영전문대학원', 'bim2023@kaist.ac.kr']], 'to': [['교수#전체', 'gr_prof@kaist.ac.kr'], ['직원#전체', 'gr_staff@kaist.ac.kr'], ['학생#전체', 'gr_stud@kaist.ac.kr']], 'cc': [], 'date': '"2024-06-12T08:19:19"', 'text_body': ['안녕하십니까?\nKAIST 바이오혁신경영전문대학원 입니다.\n\n바이오혁신경영전문대학원에서는 New Road in Bio Inventment-from Entry to Exit&nbsp;라는 큰 주제로 2024학년도 봄학기 Bio Innovation Forum이 개최됩니다.\n봄학기 네 번째로 개최되는 6월 13일(목) 포럼을 하기와 같이 안내드립니다.\n\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp;아 &nbsp; &nbsp; 래 &nbsp;-\n\n\n◑ 6월 주제 :&nbsp;한국 바이오텍 성장 모델과 벤처캐피탈의 역할&nbsp;\n◑ 연 자 : 이승우 데브시스터즈벤처스 상무\n◑ 일 시 :&nbsp;2024. 6. 13.(목) / 점심 12:00~13:00\n◑ 대 상 : KAIST 전구성원, 바이오 전문가 및 투자자&nbsp;\n◑&nbsp;Zoom URL : https://kaist.zoom.us/j/83319912177 https://kaist.zoom.us/j/83319912177 (회의 ID : 833 1991 2177)\n\nKAIST 구성원의 많은 관심과 적극적인 참여를 부탁드립니다.&nbsp;\n감사합니다.\n\n\n\n\n\n\n']}
                            Question: """},
                            {"role": "assistant", "content": f"Bio Innovation Forum 행사 대상은 누구인가요?"},
                            {"role": "user", "content": """Email:
            {'subject': '2024년 봄학기 조교 평가 안내 / Spring 2024 TA Evaluation', 'from': [['전산학부행정팀', 'leeminjae@kaist.ac.kr']], 'to': [['', 'doubleyyh@kaist.ac.kr']], 'cc': [], 'date': '"2024-07-05T07:23:06"', 'text_body': ["보낸사람\n전산학부행정팀\n\n제목\n2024년 봄학기 조교 평가 안내 / Spring 2024 TA Evaluation\n\n내용\n* 조교 평가 관리 시스템을 통해 평가자에게 메일이\n발송되는 방식으로, 혹시 평가를 완료했음에도 메일을\n수신하신 경우 양해 부탁드립니다.\n* This e-mail is sent to evaluators through the TA evaluation management\nsystem. We ask for your understanding if you've received this e-mail even\nthough you have completed the assessment.\n\n수강생 여러분께,\n \n안녕하세요.\n\n2024년 봄학기 우수조교 선발을 위해 교과목 조교 평가에\n참여를 부탁드립니다.\n하단의 바로가기를 클릭하여 평가시스템으로 접속하여\n주시기 바랍니다.\n\n＊학번(학생)/사번(교수): 학번을 입력해 주시기\n바랍니다.\n\n* 평가 기간: ~ 2024. 7. 7.(일)\n\n감사합니다.\n \n전산학부행정팀\n\nDear Students,\n\nHello.\n\nFor the Spring 2024 Best TA Award, please take a moment to fill out the\nevaluation form by clicking the link below (바로가기) to access the\nevaluation system.\n\n＊학번(학생)/사번(교수): Enter your student ID number.\n\n* Evaluation Period: ~ 2024. 7. 7.(Sun)\n\nRegards,\n\nThe Administration Team for School of Computing\n\n접속주소\n바로가기\n\n"]}
                            Question: """},
                            {"role": "assistant", "content": f"언제까지 조교 평가를 해야하나요?"},
                            {"role": "user", "content": """Email:
            {'subject': 'RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.', 'from': [['황태호', 'doubleyyh@kaist.ac.kr']], 'to': [['Jong Park', 'jongpark@kaist.ac.kr']], 'cc': [['정소영', 'starsuzi@kaist.ac.kr'], ['조석민', 'nelllpic@kaist.ac.kr'], ['한승윤', 'seungyoonee@kaist.ac.kr']], 'date': '"2024-07-04T05:39:36"', 'text_body': ['네 교수님,\n\n제출완료였습니다.&nbsp; 그 동안 도와주셔서 감사합니다.\n\n감사합니다.\n\n황태호 올림\n\n\n-----Original Message-----From:  "Jong Park" &lt;jongpark@kaist.ac.kr&gt;To:     "황태호" &lt;doubleyyh@kaist.ac.kr&gt;; Cc:     "정소영" &lt;starsuzi@kaist.ac.kr&gt;;  "조석민" &lt;nelllpic@kaist.ac.kr&gt;;  "한승윤" &lt;seungyoonee@kaist.ac.kr&gt;; Sent:  2024-07-04 (목) 12:52:26 (UTC+09:00)Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.태호 군,\n\n메일 잘 받았습니다. 이제 모두 좋습니다.&nbsp;\n이어서 제출하기 바랍니다.&nbsp;\n\n그 동안 수고 많았습니다.\n\n&nbsp; 박종철\n-----Original Message-----From: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; To: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오후 12시 47분 48초 GMT+9Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n교수님,\n\n황태호입니다.\n\n여러 번 보시게 해드려 죄송합니다. 빨리 제출해야 한다는 마음이 앞서 충분히 살피지 못한 것 같습니다. 이번에는 다 반영하였습니다. 사사는 &amp;가 들어갔어야 하는데 오버리프에서 특수문자는 \\&amp;가 들어가야 하는 것을 간과하였습니다.&nbsp; 현재는 잘 수정된 상황입니다.&nbsp;\n\n감사합니다. 점심 맛있게 드세요.\n\n황태호 올림\n\n\n-----Original Message-----From:  "Jong Park" &lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt;To:     "황태호" &lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt;; Cc:     "정소영" &lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;;  "조석민" &lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;;  "한승윤" &lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;; Sent:  2024-07-04 (목) 10:46:26 (UTC+09:00)Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.태호 군,\n\n예, 잘 알겠습니다. 사사의 경우 석민 군의 제안이 적절해 보입니다.\n그러면 제출하기 전 사사를 포함한 최종본을 공유해 주면 좋겠습니다.\n\n고맙습니다.\n\n&nbsp; 박종철\n\n-----Original Message-----From: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; To: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오전 10시 44분 19초 GMT+9Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n\n안녕하세요. 교수님,\n\n꼼꼼한 피드백 감사합니다! \U0001fae1 모든 사항 반영하였고 rankT5 모델 웨이트 \'Soyoung97/RankT5-base\'는 저희 연구실 정소영님이 아니라 평행세계의 다른 소영입니다. 하하 🤣\n\n괜찮다면 이제 최종 제출을 해보겠습니다. 카메라 레디 이후에 제출하게 되어 이메일 받고 신경쓰게 해드려 죄송합니다. 체어분에게도 감사의 표시를 다시 한 번 전하겠습니다.\n\n그리고 교수님 혹시 사사는 어떻게 하면 좋을까요?\n\n감사합니다.\n\n황태호 올림\n\n-----Original Message-----From:  "Jong Park" &lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt;To:     "황태호" &lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt;; Cc:     "정소영" &lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;;  "조석민" &lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;;  "한승윤" &lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;; Sent:  2024-07-04 (목) 10:06:41 (UTC+09:00)Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.태호 군,\n\n검토한 의견을 공유하니 첨부 문서를 확인해 보기 바랍니다.\n추가 문안 모두 좋습니다. 추가 실험 결과와 해석도 모두 좋아&nbsp;\n보입니다. 역시 모두 수고 많았습니다.\n\n의견은 20쪽까지 있으니 잘 살펴 보기 바랍니다. 두 군데\n노란색으로 하이라이트해 둔 부분이 있는데요, 표현을\n좀 더 다듬어야 할 듯 합니다.&nbsp;\n\n고맙습니다.\n\n&nbsp; 박종철\n\n-----Original Message-----From: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; To: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오전 7시 42분 58초 GMT+9Subject: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n태호 군,\n\n메일 잘 받았습니다. 모두 수고 많았습니다.&nbsp;\n확인해 보도록 하겠습니다.&nbsp;\n\n고맙습니다.&nbsp;\n\n&nbsp; 박종철\n-----Original Message-----From: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; To: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오전 2시 44분 21초 GMT+9Subject: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n\n안녕하세요. 교수님,\n\n황태호입니다. 카메라 레디 버전의 모든 실험과 글 작성이 완료되어 검토를 요청드리고자 메일을 보냅니다.\n더 좋은 연구를 자신있게 소개하고 싶어 욕심을 부려 리뷰어들의 리뷰를 최대한 반영하고 분석과 실험을 추가하였습니다.\nBut the main evaluation setting in Table 1 seems unfair to baselines:&nbsp;\n1) the context length is set to only 500 words, while current LLMs can process way longer contexts 2) DSLR should be compared with all the original retrieved passages as contexts to gauge any information loss during the sentence selection process. But it seems that passages are truncated to the fixed 500 words context length. My question is: if we have K retrieved passages and you select M sentences from them, which setting performs better, K passages or M sentences? If you set a context length, then you are essentially comparing M sentences with k (k&lt;&lt;K) passages.\nPlease correct me if I am wrong and I am happy to increase my score if these issues are clarified.\n이 리뷰에 대해서 제안해준 해당 세팅으로 실험을 재구성하여 진행하였습니다.\n&nbsp;Additionally, the efficiency of the reconstruction process, which includes all sentences from a document, is questionable.&nbsp;\n또한 이 리뷰에 따라 efficiency 측면을 더욱 강조하는 end to end latency 실험으로 실제 인퍼런스 타임을 크게 줄여 효율적임을 보이고 토큰 수를 명시하였습니다.\n&nbsp;Furthermore, a comparative analysis with methods that utilize only sentence decomposition could clarify the benefits of including re-ranking.&nbsp;\n이 리뷰는 이미 논문에 있는 내용이었는데 조금 더 표를 재구성하여 헷갈리는 일이 없도록 구성하였습니다.\nAddressing how to effectively extract and utilize this context information is essential and could significantly enhance the system’s ability to process complex queries.\n이 리뷰에 따라서 context 정보를 잘 활용하는 방법에 대한 분석들을 추가하여 파인딩스를 추가하였습니다.\n\n그리고 사사는 석민님이 스타랩과 광주서버를 같이 넣는 것이 좋겠다고 말을 하였는데 교수님 의견은 어떠신지 여쭙고 싶습니다.\n\n실험이 늦어져 늦게 드려 죄송합니다. 소중한 의견 기다리겠습니다 🙂\n\n감사합니다.\n\n황태호 올림\n\n\n\n\n\n\n\n\n\n']}
                            Question: """},
                            {"role": "assistant", "content": f"최근에 저는 어떤 학회에 논문을 제출했나요?"},
                            {"role": "user", "content": f"""Email:\n{d}\nQuestion: """}]
                        ,
                        temperature=1,
                        top_p=1,
                        n=2
        )
        questions = [completion.choices[ii].message.content for ii in range(2)]
        answers = []
        for q in questions:
            completion = client.chat.completions.create(
                            model="gpt-3.5-turbo",
                            messages=[
                                {"role": "system", "content": f"e-mail이 있을 때 이에 대한 질문에 대한 답을 한국어로 만들어주세요."},
                                {"role": "user", "content": """Email:
                {'subject': '[KAIST KPC4IR] 11월 정기세미나 안내: 디지털 시대의 심리평가와 디지털 치료', 'from': [['한국4차산업혁명정책센터', 'kpc4ir@kaist.ac.kr']], 'to': [['학생#전체 (내국인)', 'gr_stud.ko@kaist.ac.kr'], ['직원#전체 (내국인)', 'gr_staff.ko@kaist.ac.kr'], ['학생#전체 (외국인)', 'gr_stud.en@kaist.ac.kr'], ['교수#전체', 'gr_prof@kaist.ac.kr']], 'cc': [], 'date': '"2022-10-24T07:09:19"', 'text_body': ['한국4차산업혁명정책센터에서 11월 정기세미나 정보를 아래와 같이 안내드립니다.&nbsp;참석을 희망하는&nbsp;KAIST&nbsp;구성원의 많은 참여 바랍니다.\n\n1.&nbsp;일시&nbsp;: 2022년&nbsp;11월&nbsp;1일(월) 11시~12시\n2.&nbsp;제목 :&nbsp;디지털 시대의 심리평가와 디지털 치료\n3. 내용 :\n-&nbsp;심리 평가와 치료는 전통적으로 1:1 대면으로 이루어지는 매우 전문적인 활동이지만, 최근 AI 및 각종 디지털 기기의 눈부신 발전으로 &nbsp;심리 평가와 치료 영역에서도 적용가능성이 탐색되고 있다. 특히 COVID-19로 인해 비대면 심리치료 서비스가 활성화되었고, Post-COVID 시대, ‘언택트 시대’가 도래하여 심리평가 및 치료의 디지털화는 더욱 가속화되어 전통적인 심리평가 및 치료 방식에 대한 패러다임 변화가 요구되고 있다. 이에 디지털 기반 심리평가 및 디지털치료제의 개발 현황, 예상되는 이점과 문제점, 쟁점에 대해 생각해보고자 한다.&nbsp;\n4.&nbsp;연사 : 신민섭 교수\n- (현)&nbsp;서울대학교의과대학 정신과학교실/서울대학교병원 소아청소년정신과 교수\n- (현)&nbsp;한국디지털 심리학회 회장&nbsp;\n- (전)&nbsp;미국 하버드 의과대학 소아정신과 방문교수\n- (전) 네덜란드 암스테르담 프리헤대학 아동임상신경심리학과 방문교수&nbsp;\n5.&nbsp;장소:&nbsp;온라인(https://kaist.zoom.us/j/84008656163?pwd=U3lXdGFZVkVqSkx2SmovQU1TRmVVUT09 https://kaist.zoom.us/j/84008656163?pwd=U3lXdGFZVkVqSkx2SmovQU1TRmVVUT09)\n6.&nbsp;언어:&nbsp;한국어\n7.&nbsp;대상: KAIST&nbsp;구성원\n8.&nbsp;문의:&nbsp;한국4차산업혁명정책센터 백단비 연구원(bee1@kaist.ac.kr, 042-350-8672)\n&nbsp;\n\n\n\n\n\n\n\n']}
                                Question: [KAIST KPC4IR] 11월 정기세미나의 부제는 무엇인가요?"""},
                                {"role": "assistant", "content": f"[KAIST KPC4IR] 11월 정기세미나의 부제는 디지털 시대의 심리평가와 디지털 치료입니다."},
                                {"role": "user", "content": """Email:
                {'subject': '2022 Nobel Prize 수상 업적 해설 강연 개최 안내(Lecture on the Winners of Nobel Prize 2022 College of Natural Sciences, KAIST)', 'from': [['이봉여', 'bylee@kaist.ac.kr']], 'to': [['교수#전체', 'gr_prof@kaist.ac.kr'], ['학생#전체', 'gr_stud@kaist.ac.kr'], ['직원#전체', 'gr_staff@kaist.ac.kr']], 'cc': [], 'date': '"2022-10-24T08:51:26"', 'text_body': ['2022년 물리,&nbsp;화학,&nbsp;생리의학 분야에서 노벨상을 수상한 수상자들의 연구업적에 대한 해설 강연을 개최하오니 관심있는 분들의 많은 참여 부탁드립니다.\n\nThe College of Natural Sciences (CNS) at the Korea Advanced Institute of Science and Technology (KAIST) is hosting an online lecture to introduce the achievements of 2022 Nobel Prize laureates in physics, chemistry, and physiology or medicine. This will be a great opportunity to learn about how the prize winners have built their extraordinary career as a scientist and what they have focused on in their research.\nThe lecture is open to everyone, so please come and join us for the event!\n\n○ 일시(Date): October 25(Tue.) 2022, 12:00~13:00\n&nbsp; &nbsp;• Physics: 12:00 ~ 12:20\n&nbsp; &nbsp; &nbsp; &nbsp;라영식 교수 (물리학과)\n&nbsp; &nbsp; &nbsp; &nbsp;Professor Young-Sik Ra (Department of Physics)\n&nbsp; &nbsp;• Chemistry: 12:20 ~ 12:40\n&nbsp; &nbsp; &nbsp; &nbsp; 박윤수 교수 (화학과)\n&nbsp; &nbsp; &nbsp; &nbsp; Professor Yoonsu Park (Department of Chemistry)&nbsp;\n&nbsp; &nbsp;• Physiology or Medicine: 12:40 ~ 13:00\n&nbsp; &nbsp; &nbsp; &nbsp;정인경 교수 (생명과학과)\n&nbsp; &nbsp; &nbsp; &nbsp;Professor Inkyung Jung (Department of Biological Sciences)\n&nbsp; &nbsp;• MC\n&nbsp; &nbsp; &nbsp; &nbsp;변혜령 교수 (화학과)\n&nbsp; &nbsp; &nbsp; &nbsp;Professor Hye Ryung Byon (Department of Chemistry)&nbsp;\n○&nbsp;장소(venue):&nbsp;학술문화관&nbsp;5층 정근모콘퍼런스홀&nbsp;(E9)\n&nbsp; &nbsp; &nbsp;Jeong Geun-mo Conference Hall (Academic Cultural Complex E9, 5F)\n○&nbsp;Zoom:&nbsp;https://kaist.zoom.us/j/88355623723 https://kaist.zoom.us/j/88355623723\n○ 문의(Inquiry): 자연과학대학 교학팀 T. 042-350-2472,&nbsp;bylee@kaist.ac.kr\n&nbsp; &nbsp; Please contact the Academic Affairs Team of CNS at 042-350-2472 or&nbsp;bylee@kaist.ac.kr&nbsp;for any inquires.&nbsp;\n○ 현장 방문 선착순 200명 샌드위치와 음료수 제공\n&nbsp; &nbsp; Sandwiches and soda for the first 200 people on-site\n※ Zoom에서 동신통역이 제공될 예정입니다.\n&nbsp; &nbsp; &nbsp;Korean Talk,&nbsp;Simultaneous Interpretation into English via Zoom\n\n\n\n\n']}
                                Question: 어디서 2022 Nobel Prize 수상 업적 해설 강연이 개최되나요?"""},
                                {"role": "assistant", "content": f"학술문화관&nbsp;5층 정근모콘퍼런스홀&nbsp;(E9)과 Zoom에서 개최됩니다."},
                                {"role": "user", "content": """Email:
                {'subject': '[바이오혁신경영전문대학원] 2024학년도 봄학기 Bio Innovation Forum 안내(6/13(목))', 'from': [['바이오혁신경영전문대학원', 'bim2023@kaist.ac.kr']], 'to': [['교수#전체', 'gr_prof@kaist.ac.kr'], ['직원#전체', 'gr_staff@kaist.ac.kr'], ['학생#전체', 'gr_stud@kaist.ac.kr']], 'cc': [], 'date': '"2024-06-12T08:19:19"', 'text_body': ['안녕하십니까?\nKAIST 바이오혁신경영전문대학원 입니다.\n\n바이오혁신경영전문대학원에서는 New Road in Bio Inventment-from Entry to Exit&nbsp;라는 큰 주제로 2024학년도 봄학기 Bio Innovation Forum이 개최됩니다.\n봄학기 네 번째로 개최되는 6월 13일(목) 포럼을 하기와 같이 안내드립니다.\n\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp;아 &nbsp; &nbsp; 래 &nbsp;-\n\n\n◑ 6월 주제 :&nbsp;한국 바이오텍 성장 모델과 벤처캐피탈의 역할&nbsp;\n◑ 연 자 : 이승우 데브시스터즈벤처스 상무\n◑ 일 시 :&nbsp;2024. 6. 13.(목) / 점심 12:00~13:00\n◑ 대 상 : KAIST 전구성원, 바이오 전문가 및 투자자&nbsp;\n◑&nbsp;Zoom URL : https://kaist.zoom.us/j/83319912177 https://kaist.zoom.us/j/83319912177 (회의 ID : 833 1991 2177)\n\nKAIST 구성원의 많은 관심과 적극적인 참여를 부탁드립니다.&nbsp;\n감사합니다.\n\n\n\n\n\n\n']}
                                Question: Bio Innovation Forum 행사 대상은 누구인가요? """},
                                {"role": "assistant", "content": f"KAIST 전구성원, 바이오 전문가 및 투자자 대상으로 열립니다."},
                                {"role": "user", "content": """Email:
                {'subject': '2024년 봄학기 조교 평가 안내 / Spring 2024 TA Evaluation', 'from': [['전산학부행정팀', 'leeminjae@kaist.ac.kr']], 'to': [['', 'doubleyyh@kaist.ac.kr']], 'cc': [], 'date': '"2024-07-05T07:23:06"', 'text_body': ["보낸사람\n전산학부행정팀\n\n제목\n2024년 봄학기 조교 평가 안내 / Spring 2024 TA Evaluation\n\n내용\n* 조교 평가 관리 시스템을 통해 평가자에게 메일이\n발송되는 방식으로, 혹시 평가를 완료했음에도 메일을\n수신하신 경우 양해 부탁드립니다.\n* This e-mail is sent to evaluators through the TA evaluation management\nsystem. We ask for your understanding if you've received this e-mail even\nthough you have completed the assessment.\n\n수강생 여러분께,\n \n안녕하세요.\n\n2024년 봄학기 우수조교 선발을 위해 교과목 조교 평가에\n참여를 부탁드립니다.\n하단의 바로가기를 클릭하여 평가시스템으로 접속하여\n주시기 바랍니다.\n\n＊학번(학생)/사번(교수): 학번을 입력해 주시기\n바랍니다.\n\n* 평가 기간: ~ 2024. 7. 7.(일)\n\n감사합니다.\n \n전산학부행정팀\n\nDear Students,\n\nHello.\n\nFor the Spring 2024 Best TA Award, please take a moment to fill out the\nevaluation form by clicking the link below (바로가기) to access the\nevaluation system.\n\n＊학번(학생)/사번(교수): Enter your student ID number.\n\n* Evaluation Period: ~ 2024. 7. 7.(Sun)\n\nRegards,\n\nThe Administration Team for School of Computing\n\n접속주소\n바로가기\n\n"]}
                                Question: 언제까지 전산학부 조교 평가를 해야하나요?"""},
                                {"role": "assistant", "content": f"2024. 7. 7.(일)까지 조교 평가를 해야합니다."},
                                {"role": "user", "content": """Email:
                {'subject': 'RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.', 'from': [['황태호', 'doubleyyh@kaist.ac.kr']], 'to': [['Jong Park', 'jongpark@kaist.ac.kr']], 'cc': [['정소영', 'starsuzi@kaist.ac.kr'], ['조석민', 'nelllpic@kaist.ac.kr'], ['한승윤', 'seungyoonee@kaist.ac.kr']], 'date': '"2024-07-04T05:39:36"', 'text_body': ['네 교수님,\n\n제출완료였습니다.&nbsp; 그 동안 도와주셔서 감사합니다.\n\n감사합니다.\n\n황태호 올림\n\n\n-----Original Message-----From:  "Jong Park" &lt;jongpark@kaist.ac.kr&gt;To:     "황태호" &lt;doubleyyh@kaist.ac.kr&gt;; Cc:     "정소영" &lt;starsuzi@kaist.ac.kr&gt;;  "조석민" &lt;nelllpic@kaist.ac.kr&gt;;  "한승윤" &lt;seungyoonee@kaist.ac.kr&gt;; Sent:  2024-07-04 (목) 12:52:26 (UTC+09:00)Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.태호 군,\n\n메일 잘 받았습니다. 이제 모두 좋습니다.&nbsp;\n이어서 제출하기 바랍니다.&nbsp;\n\n그 동안 수고 많았습니다.\n\n&nbsp; 박종철\n-----Original Message-----From: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; To: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오후 12시 47분 48초 GMT+9Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n교수님,\n\n황태호입니다.\n\n여러 번 보시게 해드려 죄송합니다. 빨리 제출해야 한다는 마음이 앞서 충분히 살피지 못한 것 같습니다. 이번에는 다 반영하였습니다. 사사는 &amp;가 들어갔어야 하는데 오버리프에서 특수문자는 \\&amp;가 들어가야 하는 것을 간과하였습니다.&nbsp; 현재는 잘 수정된 상황입니다.&nbsp;\n\n감사합니다. 점심 맛있게 드세요.\n\n황태호 올림\n\n\n-----Original Message-----From:  "Jong Park" &lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt;To:     "황태호" &lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt;; Cc:     "정소영" &lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;;  "조석민" &lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;;  "한승윤" &lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;; Sent:  2024-07-04 (목) 10:46:26 (UTC+09:00)Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.태호 군,\n\n예, 잘 알겠습니다. 사사의 경우 석민 군의 제안이 적절해 보입니다.\n그러면 제출하기 전 사사를 포함한 최종본을 공유해 주면 좋겠습니다.\n\n고맙습니다.\n\n&nbsp; 박종철\n\n-----Original Message-----From: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; To: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오전 10시 44분 19초 GMT+9Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n\n안녕하세요. 교수님,\n\n꼼꼼한 피드백 감사합니다! \U0001fae1 모든 사항 반영하였고 rankT5 모델 웨이트 \'Soyoung97/RankT5-base\'는 저희 연구실 정소영님이 아니라 평행세계의 다른 소영입니다. 하하 🤣\n\n괜찮다면 이제 최종 제출을 해보겠습니다. 카메라 레디 이후에 제출하게 되어 이메일 받고 신경쓰게 해드려 죄송합니다. 체어분에게도 감사의 표시를 다시 한 번 전하겠습니다.\n\n그리고 교수님 혹시 사사는 어떻게 하면 좋을까요?\n\n감사합니다.\n\n황태호 올림\n\n-----Original Message-----From:  "Jong Park" &lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt;To:     "황태호" &lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt;; Cc:     "정소영" &lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;;  "조석민" &lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;;  "한승윤" &lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;; Sent:  2024-07-04 (목) 10:06:41 (UTC+09:00)Subject: RE: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.태호 군,\n\n검토한 의견을 공유하니 첨부 문서를 확인해 보기 바랍니다.\n추가 문안 모두 좋습니다. 추가 실험 결과와 해석도 모두 좋아&nbsp;\n보입니다. 역시 모두 수고 많았습니다.\n\n의견은 20쪽까지 있으니 잘 살펴 보기 바랍니다. 두 군데\n노란색으로 하이라이트해 둔 부분이 있는데요, 표현을\n좀 더 다듬어야 할 듯 합니다.&nbsp;\n\n고맙습니다.\n\n&nbsp; 박종철\n\n-----Original Message-----From: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; To: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오전 7시 42분 58초 GMT+9Subject: RE: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n태호 군,\n\n메일 잘 받았습니다. 모두 수고 많았습니다.&nbsp;\n확인해 보도록 하겠습니다.&nbsp;\n\n고맙습니다.&nbsp;\n\n&nbsp; 박종철\n-----Original Message-----From: 황태호&lt;doubleyyh@kaist.ac.kr mailto:doubleyyh@kaist.ac.kr&gt; To: Jong Park&lt;jongpark@kaist.ac.kr mailto:jongpark@kaist.ac.kr&gt; Cc: 정소영&lt;starsuzi@kaist.ac.kr mailto:starsuzi@kaist.ac.kr&gt;; 조석민&lt;nelllpic@kaist.ac.kr mailto:nelllpic@kaist.ac.kr&gt;; 한승윤&lt;seungyoonee@kaist.ac.kr mailto:seungyoonee@kaist.ac.kr&gt;Sent: 2024년 7월 4일 오전 2시 44분 21초 GMT+9Subject: ACL knowledge workshop 카메라 레디 버전 검토 요청드립니다.&nbsp;\n\n안녕하세요. 교수님,\n\n황태호입니다. 카메라 레디 버전의 모든 실험과 글 작성이 완료되어 검토를 요청드리고자 메일을 보냅니다.\n더 좋은 연구를 자신있게 소개하고 싶어 욕심을 부려 리뷰어들의 리뷰를 최대한 반영하고 분석과 실험을 추가하였습니다.\nBut the main evaluation setting in Table 1 seems unfair to baselines:&nbsp;\n1) the context length is set to only 500 words, while current LLMs can process way longer contexts 2) DSLR should be compared with all the original retrieved passages as contexts to gauge any information loss during the sentence selection process. But it seems that passages are truncated to the fixed 500 words context length. My question is: if we have K retrieved passages and you select M sentences from them, which setting performs better, K passages or M sentences? If you set a context length, then you are essentially comparing M sentences with k (k&lt;&lt;K) passages.\nPlease correct me if I am wrong and I am happy to increase my score if these issues are clarified.\n이 리뷰에 대해서 제안해준 해당 세팅으로 실험을 재구성하여 진행하였습니다.\n&nbsp;Additionally, the efficiency of the reconstruction process, which includes all sentences from a document, is questionable.&nbsp;\n또한 이 리뷰에 따라 efficiency 측면을 더욱 강조하는 end to end latency 실험으로 실제 인퍼런스 타임을 크게 줄여 효율적임을 보이고 토큰 수를 명시하였습니다.\n&nbsp;Furthermore, a comparative analysis with methods that utilize only sentence decomposition could clarify the benefits of including re-ranking.&nbsp;\n이 리뷰는 이미 논문에 있는 내용이었는데 조금 더 표를 재구성하여 헷갈리는 일이 없도록 구성하였습니다.\nAddressing how to effectively extract and utilize this context information is essential and could significantly enhance the system’s ability to process complex queries.\n이 리뷰에 따라서 context 정보를 잘 활용하는 방법에 대한 분석들을 추가하여 파인딩스를 추가하였습니다.\n\n그리고 사사는 석민님이 스타랩과 광주서버를 같이 넣는 것이 좋겠다고 말을 하였는데 교수님 의견은 어떠신지 여쭙고 싶습니다.\n\n실험이 늦어져 늦게 드려 죄송합니다. 소중한 의견 기다리겠습니다 🙂\n\n감사합니다.\n\n황태호 올림\n\n\n\n\n\n\n\n\n\n']}
                                Question: 2024년 6월 즘에 저는 어떤 학회에 논문을 제출했나요?"""},
                                {"role": "assistant", "content": f"ACL knowledge workshop에 제출했습니다."},
                                {"role": "user", "content": f"""Email:\n{d}\nQuestion: {q}"""}]
                            ,
                            temperature=0,
                            top_p=1,
                            n=1
            )
            answers.append(completion.choices[0].message.content)


        temp = {
            "email_id": i,
            "questions": questions,
            "answers": answers
        }
        result.append(temp)
        if i % 100 == 0:
            with open("/data/taeho/email_questions_t.json", "w") as f:
                json.dump(result, f)
    except:
        print(i)
        continue

# dump json
with open("/data/taeho/email_questions.json", "w") as f:
    json.dump(result, f)

